
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>lib_sconf &#8212; Flexible integration of continuous sensory evidence in perceptual estimation tasks</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="../_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" href="../_static/styles/sphinx-book-theme.css?digest=5115cc725059bd94278eecd172e13a965bf8f5a9" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/crm.css" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?digest=9c920249402e914e316237a7dbc6769907cce411"></script>
    <script src="../_static/read-more.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/design-tabs.js"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <link rel="shortcut icon" href="../_static/flexbump_icon.svg"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay overlay-navbar" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input type="checkbox" class="sidebar-toggle" name="__page-toc" id="__page-toc" aria-label="Toggle in-page Table of Contents">
<label class="overlay overlay-pagetoc" for="__page-toc">
    <div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint">⚠ Warning! Under development! ⚠</div>
<div class="header header-item noprint"></div>

    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
    <div class="bd-sidebar__content">
        <div class="bd-sidebar__top"><div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="../_static/flex_bump.svg" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">Flexible integration of continuous sensory evidence in perceptual estimation tasks</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../index.html">
                    Flexible integration of continuous sensory evidence in perceptual estimation tasks
                </a>
            </li>
        </ul>
        <ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../howto/index.html">
   Getting started
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../user_guide/index.html">
   User guide
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../data/index.html">
   Data
  </a>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../code/index.html">
   API Reference
  </a>
  <input checked class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../code/utils_libraries.html">
     Auxiliary libraries
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
    <label for="toctree-checkbox-2">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../code/generated/lib_parallel.ParallelSimulation.__init__.html">
       lib_parallel.ParallelSimulation.__init__
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../code/generated/lib_parallel.ParallelSimulation.__call__.html">
       lib_parallel.ParallelSimulation.__call__
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../code/generated/lib_parallel.ParallelSimulation.distribute_trials.html">
       lib_parallel.ParallelSimulation.distribute_trials
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../code/generated/lib_parallel.ParallelSimulation.run_task_unpack.html">
       lib_parallel.ParallelSimulation.run_task_unpack
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../code/generated/lib_parallel.ParallelSimulation.poolcontext.html">
       lib_parallel.ParallelSimulation.poolcontext
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../code/generated/lib_parallel.ParallelSimulation.worker.html">
       lib_parallel.ParallelSimulation.worker
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../code/generated/lib_parallel.ParallelSimulation.print_table.html">
       lib_parallel.ParallelSimulation.print_table
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../code/generated/lib_sconf.parser_init.html">
       lib_sconf.parser_init
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../code/generated/lib_sconf.parser.html">
       lib_sconf.parser
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../code/generated/lib_sconf.log_conf.html">
       lib_sconf.log_conf
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../code/generated/lib_sconf.MyLog.html">
       lib_sconf.MyLog
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../code/generated/lib_sconf.debug_func.html">
       lib_sconf.debug_func
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../code/generated/lib_sconf.count_calls.html">
       lib_sconf.count_calls
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../code/generated/lib_sconf.get_paths.html">
       lib_sconf.get_paths
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../code/generated/lib_sconf.create_dir.html">
       lib_sconf.create_dir
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../code/generated/lib_sconf.path_exists.html">
       lib_sconf.path_exists
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../code/generated/lib_sconf.check_overwrite.html">
       lib_sconf.check_overwrite
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../code/generated/lib_sconf.save_obj.html">
       lib_sconf.save_obj
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../code/generated/lib_sconf.load_obj.html">
       lib_sconf.load_obj
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../code/generated/lib_sconf.now.html">
       lib_sconf.now
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../code/generated/lib_sconf.yesno_question.html">
       lib_sconf.yesno_question
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../code/generated/lib_sconf.isnotebook.html">
       lib_sconf.isnotebook
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../code/generated/lib_sconf.print_at.html">
       lib_sconf.print_at
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../code/generated/lib_sconf.LimitedSizeDict.html">
       lib_sconf.LimitedSizeDict
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../code/generated/lib_sconf.dict_depth.html">
       lib_sconf.dict_depth
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../code/generated/lib_sconf.fmt_latex_table.html">
       lib_sconf.fmt_latex_table
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../code/generated/lib_sconf.truncate.html">
       lib_sconf.truncate
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
</ul>

    </div>
</nav></div>
        <div class="bd-sidebar__bottom">
             <!-- To handle the deprecated key -->
            
        </div>
    </div>
    <div id="rtd-footer-container"></div>
</div>


          


          
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
    
    <div class="header-article row sticky-top noprint">
        



<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        
        <label for="__navigation"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="right"
title="Toggle navigation"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-bars"></i>
  </span>

</label>

        
    </div>
    <div class="header-article__right">
<button onclick="toggleFullScreen()"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="bottom"
title="Fullscreen mode"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>

<div class="menu-dropdown menu-dropdown-repository-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Source repositories">
      <i class="fab fa-github"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://github.com/wimmerlab/flexbump"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Source repository"
>
  

<span class="headerbtn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="headerbtn__text-container">repository</span>
</a>

      </li>
      
      <li>
        <a href="https://github.com/wimmerlab/flexbump/issues/new?title=Issue%20on%20page%20%2F_modules/lib_sconf.html&body=Your%20issue%20content%20here."
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Open an issue"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="headerbtn__text-container">open issue</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

    </div>
</div>

<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
</div>
    </div>
    <div class="article row">
        <div class="col pl-md-3 pl-lg-5 content-container">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1></h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                    </div>
                </div>
            </div>
            <main id="main-content" role="main">
                
              <div>
                
  <h1>Source code for lib_sconf</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">General purpose preprocessing library</span>
<span class="sd">=====================================</span>

<span class="sd">.. module:: lib_sconf</span>
<span class="sd">   :platform: Linux</span>
<span class="sd">   :synopsis: tool library to manage argument parsing, logging, path configuration, object saving, etc.</span>

<span class="sd">.. moduleauthor:: Jose M. Esnaola-Acebes &lt;josemesnaola@gmail.com&gt;</span>


<span class="sd">Parsing methods</span>
<span class="sd">---------------</span>

<span class="sd">.. autosummary::</span>
<span class="sd">   :toctree: generated/</span>

<span class="sd">   parser_init       Initializes parsing of arguments from an external configuration file.</span>
<span class="sd">   parser            Completes the initial parsing taking command-line arguments.</span>

<span class="sd">Logging and debugging methods and objects</span>
<span class="sd">-----------------------------------------</span>

<span class="sd">.. autosummary::</span>
<span class="sd">   :toctree: generated/</span>

<span class="sd">   log_conf          Sets up logging configuration.</span>
<span class="sd">   MyLog             A class that makes use of :func:`msg`.</span>
<span class="sd">   debug_func        Decorator that prints the function signature ant its return value.</span>
<span class="sd">   count_calls       Decorator that counts the number of calls of the decorated function.</span>

<span class="sd">Path-related methods</span>
<span class="sd">--------------------</span>

<span class="sd">.. autosummary::</span>
<span class="sd">   :toctree: generated/</span>

<span class="sd">   get_paths         Gets the absolute and relative paths of a given file.</span>
<span class="sd">   create_dir        Creates a directory if it does not exist.</span>
<span class="sd">   path_exists       Checks whether a path exists or not.</span>
<span class="sd">   check_overwrite   Checks whether a path exists and overwrites it if necessary.</span>

<span class="sd">Saving and loading methods</span>
<span class="sd">--------------------------</span>

<span class="sd">.. autosummary::</span>
<span class="sd">   :toctree: generated/</span>

<span class="sd">   save_obj          Save a given object at a given path.</span>
<span class="sd">   load_obj          Loads an object from a given path.</span>

<span class="sd">Miscellaneous objects</span>
<span class="sd">---------------------</span>

<span class="sd">.. autosummary::</span>
<span class="sd">   :toctree: generated/</span>

<span class="sd">   now               Gets a string with the date and daytime.</span>
<span class="sd">   yesno_question    Asks a target question with Yes or No answer.</span>
<span class="sd">   isnotebook        Checks whether the execution is being held in a notebook.</span>
<span class="sd">   print_at          Prints a string at a specific location of the terminal&#39;s screen.</span>
<span class="sd">   LimitedSizeDict   Creates a dictionary of limited size.</span>
<span class="sd">   dict_depth        Computes the depth of a dictionary.</span>
<span class="sd">   fmt_latex_table   Formats a given table (dictionary) into a latex table</span>
<span class="sd">   truncate          Truncates a floating point number up to a given decimal</span>

<span class="sd">Implementation</span>
<span class="sd">--------------</span>

<span class="sd">.. todo::</span>

<span class="sd">   Implementation notes.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">argparse</span>

<span class="k">try</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">yaml</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="k">raise</span> <span class="ne">ImportError</span><span class="p">(</span>
        <span class="s1">&#39;Install pyyaml module: pip install PyYAML</span><span class="se">\t</span><span class="s1">or</span><span class="se">\t</span><span class="s1">conda install pyyaml&#39;</span><span class="p">)</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">pathlib</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Union</span>
<span class="kn">import</span> <span class="nn">datetime</span>
<span class="kn">import</span> <span class="nn">logging.config</span>
<span class="kn">import</span> <span class="nn">pickle</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">OrderedDict</span>
<span class="kn">from</span> <span class="nn">collections.abc</span> <span class="kn">import</span> <span class="n">Iterable</span>
<span class="kn">import</span> <span class="nn">functools</span>

<span class="k">try</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">readchar</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="k">raise</span> <span class="ne">ImportError</span><span class="p">(</span><span class="s2">&quot;Install `readchar` module: pip install readchar&quot;</span><span class="p">)</span>

<span class="k">try</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">colorlog</span> <span class="kn">import</span> <span class="n">ColoredFormatter</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="k">raise</span> <span class="ne">ImportError</span><span class="p">(</span><span class="s2">&quot;Install `colorlog` module: pip install colorlog&quot;</span><span class="p">)</span>

<span class="n">__author__</span> <span class="o">=</span> <span class="s1">&#39;Jose M. Esnaola-Acebes&#39;</span>
<span class="n">__docformat__</span> <span class="o">=</span> <span class="s1">&#39;reStructuredText&#39;</span>

<span class="c1"># logging.getLogger(&#39;lib_sconf&#39;).addHandler(logging.NullHandler())</span>
<span class="n">log</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">ESC</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\x1b</span><span class="s2">&quot;</span>
<span class="p">(</span><span class="n">RED</span><span class="p">,</span> <span class="n">GREEN</span><span class="p">,</span> <span class="n">YELLOW</span><span class="p">,</span> <span class="n">CYAN</span><span class="p">,</span> <span class="n">WHITE</span><span class="p">)</span> <span class="o">=</span> <span class="p">[</span><span class="n">ESC</span> <span class="o">+</span> <span class="s2">&quot;[</span><span class="si">%d</span><span class="s2">m&quot;</span> <span class="o">%</span> <span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">31</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">33</span><span class="p">,</span> <span class="mi">36</span><span class="p">,</span> <span class="mi">37</span><span class="p">]]</span>
<span class="p">(</span><span class="n">BRED</span><span class="p">,</span> <span class="n">BGREEN</span><span class="p">,</span> <span class="n">BYELLOW</span><span class="p">,</span> <span class="n">BCYAN</span><span class="p">,</span> <span class="n">BWHITE</span><span class="p">)</span> <span class="o">=</span> <span class="p">[</span><span class="n">ESC</span> <span class="o">+</span> <span class="s2">&quot;[1;</span><span class="si">%d</span><span class="s2">m&quot;</span> <span class="o">%</span> <span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">31</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">33</span><span class="p">,</span> <span class="mi">36</span><span class="p">,</span> <span class="mi">37</span><span class="p">]]</span>
<span class="p">(</span><span class="n">UP</span><span class="p">,</span> <span class="n">DOWN</span><span class="p">,</span> <span class="n">RIGHT</span><span class="p">,</span> <span class="n">LEFT</span><span class="p">)</span> <span class="o">=</span> <span class="p">[</span><span class="n">ESC</span> <span class="o">+</span> <span class="s2">&quot;[1</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">letter</span> <span class="k">for</span> <span class="n">letter</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="s1">&#39;B&#39;</span><span class="p">,</span> <span class="s1">&#39;C&#39;</span><span class="p">,</span> <span class="s1">&#39;D&#39;</span><span class="p">]]</span>
<span class="n">DEL_LINE</span> <span class="o">=</span> <span class="n">ESC</span> <span class="o">+</span> <span class="s2">&quot;[2k&quot;</span>

<span class="n">EXAMPLE_CONF</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">Block example title:</span>
<span class="s2">  -a --argument:</span>
<span class="s2">    description: &quot;Example of how to introduce list arguments.&quot;</span>
<span class="s2">    default:     [1]</span>
<span class="s2">    name:        &quot;&lt;argument&gt;&quot;</span>
<span class="s2">    choices:     ~</span>
<span class="s2">  -anthr --another:</span>
<span class="s2">    description: &quot;Another example, for float arguments.&quot;</span>
<span class="s2">    default:     0.0</span>
<span class="s2">    name:        &quot;&lt;another&gt;&quot;</span>
<span class="s2">    choices:     ~</span>
<span class="s2">Another Block example title:</span>
<span class="s2">  -s --string:</span>
<span class="s2">    description: &quot;String argument example with choices.&quot;</span>
<span class="s2">    default:     &#39;string&#39;</span>
<span class="s2">    name:        &quot;&lt;string&gt;&quot;</span>
<span class="s2">    choices:     [&#39;string1&#39;, &#39;string2&#39;]</span>
<span class="s2">  -b --boolean:</span>
<span class="s2">    description: &quot;Boolean argument example with choices.&quot;</span>
<span class="s2">    default:     False</span>
<span class="s2">    name:        &quot;&lt;bool&gt;&quot;</span>
<span class="s2">    choices:     [False, True]</span>
<span class="s2">&quot;&quot;&quot;</span>


<div class="viewcode-block" id="Parser"><a class="viewcode-back" href="../code/utils_libraries.html#lib_sconf.Parser">[docs]</a><span class="k">class</span> <span class="nc">Parser</span><span class="p">(</span><span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Wrapper class that helps parsing command-line arguments whose description is based on a configuration</span>
<span class="sd">    file or a configuration string or a configuration dictionary. The configuration file or string must have</span>
<span class="sd">    PyYaml format.</span>

<span class="sd">    Examples</span>
<span class="sd">    ^^^^^^^^</span>

<span class="sd">     - Use a rich format configuration file or string:</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">usage</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">groups</span><span class="o">=</span><span class="p">(</span><span class="kc">None</span><span class="p">,),</span> <span class="n">conf</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Initialization of the class: if ``conf`` is of type :py:class:`str`, first tries to load a</span>
<span class="sd">        possible configuration file ``conf``. If this fails, tries to interpret the configuration as</span>
<span class="sd">        a PyYaml string.</span>

<span class="sd">        If ``conf`` is a dictionary, use this dictionary to initialize the parser. If no ``conf``</span>
<span class="sd">        is given, try a initial parsing with a basic parsing configuration and look for a configuration file</span>
<span class="sd">        passed through command line arguments.</span>

<span class="sd">        :param list of str or None args: list of arguments that will be parsed.</span>
<span class="sd">        :param str desc: Description to be printed in terminal.</span>
<span class="sd">        :param str usage: Help description to be printed whith ``-h`` or ``--help`` cmd arguments.</span>
<span class="sd">        :param list of str groups or tuple of str groups: list of groups used to classify the arguments.</span>
<span class="sd">        :param str or None or dict conf: configuration file or string, or dictionary.</span>
<span class="sd">        :param bool debug: whether to debug the parsing process.</span>
<span class="sd">        :param kwargs: additional keyword arguments passed to :func:`__call__`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">args</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">args</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Initiating logging module.&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">args</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="mi">10</span> <span class="k">if</span> <span class="n">debug</span> <span class="ow">or</span> <span class="p">(</span><span class="s1">&#39;DEBUG&#39;</span> <span class="ow">in</span> <span class="n">args</span><span class="p">)</span> <span class="k">else</span> <span class="mi">20</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_log</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s1">&#39;lib_sconf.Parser&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Initializing Parser.&#39;</span><span class="p">)</span>

        <span class="c1"># Initialization of the Parser</span>
        <span class="n">usage</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;python </span><span class="si">{</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">s</span><span class="si">}</span><span class="s2"> [-O &lt;options&gt;]&quot;</span> <span class="k">if</span> <span class="n">usage</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">usage</span>
        <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">add_help</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="n">desc</span><span class="p">,</span> <span class="n">usage</span><span class="o">=</span><span class="n">usage</span><span class="p">)</span>
        <span class="c1"># Variables of this class</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_args</span> <span class="o">=</span> <span class="n">args</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_gr_labels</span> <span class="o">=</span> <span class="n">groups</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_first_args</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_second_args</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">conf_path</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">debug_level</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">help</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_help_command</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_conf</span> <span class="o">=</span> <span class="n">conf</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_conf_loaded</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_req_args</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_n_opt</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_n_req</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="c1"># Dictionary and namespace</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">opts</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">args</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">groups</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="c1"># Set up the parser</span>
        <span class="bp">self</span><span class="o">.</span><span class="fm">__call__</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">conf</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="c1"># Check if the debug level is correctly set</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">debug_level</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">debug_level</span> <span class="o">=</span> <span class="nb">vars</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">)[</span><span class="s1">&#39;db&#39;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">getLevelName</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">debug_level</span><span class="p">))</span>

    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">conf</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">required_args</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">add_groups</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">force_conf</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">parse</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Search for a valid configuration, set up the parsing configuration, and parse.</span>

<span class="sd">        :param list of str or None args: list of arguments that will be parsed.</span>
<span class="sd">        :param dict or str or None conf: configuration file or string or dictionary.</span>
<span class="sd">        :param dict or None required_args: required arguments dictionary.</span>
<span class="sd">        :param bool add_groups: whether to add grouped arguments to the main dictionary ``opts``.</span>
<span class="sd">        :param bool force_conf: whether to force the configuration.</span>
<span class="sd">        :param bool parse: whether to parse arguments now.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">args</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_args</span> <span class="o">=</span> <span class="n">args</span>
        <span class="k">if</span> <span class="n">required_args</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_req_args</span> <span class="o">=</span> <span class="n">required_args</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_conf_loaded</span> <span class="ow">or</span> <span class="n">force_conf</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">conf</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_conf</span> <span class="o">=</span> <span class="n">conf</span>
            <span class="c1"># Try to load a configuration using ``conf``</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_conf</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>  <span class="c1"># No configuration has been loaded yet.</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_conf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_load_conf_file</span><span class="p">(</span><span class="n">conf</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_conf</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>  <span class="c1"># No configuration has been loaded yet.</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_initial_parsing</span><span class="p">()</span>  <span class="c1"># try to load it using command line arguments.</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_conf</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">AssertionError</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Parser configuration could not be loaded.&#39;</span><span class="p">)</span>
                <span class="k">return</span>

            <span class="c1"># Configure the parsing</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Configuring the parser.&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_load_conf</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_req_args</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_conf_loaded</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="c1"># Parse the arguments</span>
        <span class="k">if</span> <span class="n">parse</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_conf_loaded</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_parse_args</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_args</span><span class="p">,</span> <span class="n">add_groups</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_load_conf_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">conf</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;PyYaml style configuration loader.</span>

<span class="sd">        :param str or None conf: configuration file or string.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">_conf</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_conf</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="c1"># Try to load a configuration from a file</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Trying to read a configuration file (</span><span class="si">{</span><span class="n">conf</span><span class="si">}</span><span class="s2">).&quot;</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">conf</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                    <span class="n">_conf</span> <span class="o">=</span> <span class="n">yaml</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">Loader</span><span class="o">=</span><span class="n">yaml</span><span class="o">.</span><span class="n">FullLoader</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">IOError</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Configuration file not found or cannot be read.&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Falling back to PyYaml loading of the string.&quot;</span><span class="p">)</span>
                <span class="n">_conf</span> <span class="o">=</span> <span class="n">yaml</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">conf</span><span class="p">,</span> <span class="n">Loader</span><span class="o">=</span><span class="n">yaml</span><span class="o">.</span><span class="n">FullLoader</span><span class="p">)</span>
            <span class="k">except</span> <span class="n">yaml</span><span class="o">.</span><span class="n">YAMLError</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Error loading configuration, bad format.&quot;</span><span class="p">,</span> <span class="n">exc</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">_conf</span>

    <span class="k">def</span> <span class="nf">_initial_parsing</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Method that tries to find a configuration file in the command-line arguments that will</span>
<span class="sd">        be used to parse the rest of the commands.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Add first order arguments to configuration</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-f&#39;</span><span class="p">,</span> <span class="s1">&#39;--file&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s2">&quot;conf.txt&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;-f&#39;</span><span class="p">,</span> <span class="n">metavar</span><span class="o">=</span><span class="s1">&#39;&lt;file&gt;&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-db&#39;</span><span class="p">,</span> <span class="s1">&#39;--debug&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s2">&quot;INFO&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;db&#39;</span><span class="p">,</span> <span class="n">metavar</span><span class="o">=</span><span class="s1">&#39;&lt;debug&gt;&#39;</span><span class="p">,</span>
                          <span class="n">choices</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;DEBUG&#39;</span><span class="p">,</span> <span class="s1">&#39;INFO&#39;</span><span class="p">,</span> <span class="s1">&#39;WARNING&#39;</span><span class="p">,</span> <span class="s1">&#39;ERROR&#39;</span><span class="p">,</span> <span class="s1">&#39;CRITICAL&#39;</span><span class="p">])</span>
        <span class="c1"># Check for arguments matching the latter options</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_first_args</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_second_args</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_known_args</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_args</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">conf_path</span> <span class="o">=</span> <span class="nb">vars</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_first_args</span><span class="p">)[</span><span class="s1">&#39;-f&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">debug_level</span> <span class="o">=</span> <span class="nb">vars</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_first_args</span><span class="p">)[</span><span class="s1">&#39;db&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">getLevelName</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">debug_level</span><span class="p">))</span>
        <span class="c1"># Search for help option among the non-parsed arguments</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">help</span> <span class="o">=</span> <span class="kc">True</span> <span class="k">if</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_second_args</span><span class="p">)</span><span class="o">.</span><span class="n">intersection</span><span class="p">({</span><span class="s1">&#39;-h&#39;</span><span class="p">,</span> <span class="s1">&#39;--help&#39;</span><span class="p">})</span> <span class="k">else</span> <span class="kc">False</span>
        <span class="c1"># Try to load the configuration file if any</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">conf_path</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_conf</span> <span class="o">=</span> <span class="n">yaml</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">Loader</span><span class="o">=</span><span class="n">yaml</span><span class="o">.</span><span class="n">FullLoader</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">IOError</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Configuration file not found or cannot be read.&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">yaml</span><span class="o">.</span><span class="n">YAMLError</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Error loading configuration, bad format.&quot;</span><span class="p">,</span> <span class="n">exc</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_load_conf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">req_args</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set up the parsing configuration using a configuration dictionary.</span>

<span class="sd">        The configuration may contain groups, such that arguments are grouped using those groups.</span>

<span class="sd">        :param dict or None req_args: required arguments dictionary.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_n_opt</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">depth_of_conf</span> <span class="o">=</span> <span class="n">dict_depth</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_conf</span><span class="p">)</span>
        <span class="c1"># Load configuration of optional arguments</span>
        <span class="k">if</span> <span class="n">depth_of_conf</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>  <span class="c1"># If the configuration dictionary has a rich format (name, description, etc.)</span>
            <span class="k">if</span> <span class="n">depth_of_conf</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_conf</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;Options&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_conf</span><span class="p">}</span>
            <span class="k">for</span> <span class="n">group</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_conf</span><span class="p">:</span>  <span class="c1"># Search and store arguments by groups</span>
                <span class="k">if</span> <span class="n">group</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_gr_labels</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">groups</span><span class="p">[</span><span class="n">group</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="n">gr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_argument_group</span><span class="p">(</span><span class="n">group</span><span class="p">)</span>  <span class="c1"># Group</span>
                <span class="n">ops</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_conf</span><span class="p">[</span><span class="n">group</span><span class="p">]</span>  <span class="c1"># Set of arguments inside group</span>
                <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_conf</span><span class="p">[</span><span class="n">group</span><span class="p">]:</span>  <span class="c1"># Search keyword arguments in each group</span>
                    <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;h&#39;</span><span class="p">,</span> <span class="s1">&#39;help&#39;</span><span class="p">,</span> <span class="s1">&#39;-h&#39;</span><span class="p">,</span> <span class="s1">&#39;--help&#39;</span><span class="p">):</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Key </span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2"> is normally reserved for the help command, overwriting.&quot;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_n_opt</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="n">flags</span> <span class="o">=</span> <span class="n">key</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                    <span class="n">def_v</span> <span class="o">=</span> <span class="n">ops</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;default&quot;</span><span class="p">,</span> <span class="s2">&quot;null&quot;</span><span class="p">)</span>
                    <span class="n">descr</span> <span class="o">=</span> <span class="n">ops</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;description&quot;</span><span class="p">,</span> <span class="s2">&quot;No description.&quot;</span><span class="p">)</span>
                    <span class="n">mname</span> <span class="o">=</span> <span class="n">ops</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;meta</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_n_opt</span><span class="si">:</span><span class="s2">02d</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="n">chois</span> <span class="o">=</span> <span class="n">ops</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;choices&quot;</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
                    <span class="n">v_nam</span> <span class="o">=</span> <span class="n">flags</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">:]</span>

                    <span class="k">try</span><span class="p">:</span>
                        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">def_v</span><span class="p">,</span> <span class="nb">bool</span><span class="p">):</span>  <span class="c1"># Distinguish between bool, list, and others.</span>
                            <span class="n">gr</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="o">*</span><span class="n">flags</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="n">def_v</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="n">descr</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="n">v_nam</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store_true&#39;</span><span class="p">)</span>
                        <span class="k">elif</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">def_v</span><span class="p">,</span> <span class="s1">&#39;__getitem__&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">def_v</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                            <span class="n">tipado</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="n">def_v</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                            <span class="n">gr</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="o">*</span><span class="n">flags</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="n">def_v</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="n">descr</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="n">v_nam</span><span class="p">,</span> <span class="n">metavar</span><span class="o">=</span><span class="n">mname</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="n">tipado</span><span class="p">,</span>
                                            <span class="n">choices</span><span class="o">=</span><span class="n">chois</span><span class="p">,</span> <span class="n">nargs</span><span class="o">=</span><span class="s1">&#39;+&#39;</span><span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">gr</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="o">*</span><span class="n">flags</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="n">def_v</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="n">descr</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="n">v_nam</span><span class="p">,</span> <span class="n">metavar</span><span class="o">=</span><span class="n">mname</span><span class="p">,</span>
                                            <span class="nb">type</span><span class="o">=</span><span class="nb">type</span><span class="p">(</span><span class="n">def_v</span><span class="p">),</span> <span class="n">choices</span><span class="o">=</span><span class="n">chois</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">group</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_gr_labels</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">groups</span><span class="p">[</span><span class="n">group</span><span class="p">][</span><span class="n">flags</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">:]]</span> <span class="o">=</span> <span class="n">def_v</span>
                    <span class="k">except</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentError</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Conflicting option string: </span><span class="si">{</span><span class="n">flags</span><span class="si">}</span><span class="s1">. Skipping.&#39;</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_n_opt</span> <span class="o">-=</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>  <span class="c1"># If the configuration dictionary if of type: {name: value, -name: value}</span>
            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_conf</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;h&#39;</span><span class="p">,</span> <span class="s1">&#39;help&#39;</span><span class="p">,</span> <span class="s1">&#39;-h&#39;</span><span class="p">,</span> <span class="s1">&#39;--help&#39;</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Key </span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2"> is normally reserved for the help command, overwriting.&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_n_opt</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                    <span class="n">key</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="n">flags</span> <span class="o">=</span> <span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="s2">&quot;-&quot;</span> <span class="o">+</span> <span class="n">key</span><span class="p">)</span> <span class="k">if</span> <span class="n">key</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)</span> <span class="k">else</span> <span class="p">(</span><span class="s2">&quot;-&quot;</span> <span class="o">+</span> <span class="n">key</span><span class="p">,</span> <span class="s2">&quot;--&quot;</span> <span class="o">+</span> <span class="n">key</span><span class="p">)</span>
                <span class="n">def_v</span> <span class="o">=</span> <span class="n">value</span>
                <span class="n">v_nam</span> <span class="o">=</span> <span class="n">flags</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">:]</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">def_v</span><span class="p">,</span> <span class="nb">bool</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="o">*</span><span class="n">flags</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="n">def_v</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="n">v_nam</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store_true&#39;</span><span class="p">)</span>
                <span class="k">elif</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">def_v</span><span class="p">,</span> <span class="s1">&#39;__getitem__&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">def_v</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                    <span class="n">tipado</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="n">value</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="o">*</span><span class="n">flags</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="n">def_v</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="n">v_nam</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="n">tipado</span><span class="p">,</span> <span class="n">nargs</span><span class="o">=</span><span class="s1">&#39;+&#39;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="o">*</span><span class="n">flags</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="n">def_v</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="n">v_nam</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">type</span><span class="p">(</span><span class="n">def_v</span><span class="p">))</span>
        <span class="c1"># Manually try to add help command</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-h&#39;</span><span class="p">,</span> <span class="s1">&#39;--help&#39;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s1">&#39;Print help&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store_true&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_help_command</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_n_opt</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">except</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentError</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Conflicting option string: &#39;-h --help&#39;. Skipping.&quot;</span><span class="p">)</span>
        <span class="c1"># Load configuration of required arguments (if any)</span>
        <span class="k">if</span> <span class="n">req_args</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Configuring required arguments.&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">arg</span><span class="p">,</span> <span class="n">options</span> <span class="ow">in</span> <span class="n">req_args</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="n">arg</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_n_req</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">except</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentError</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Conflicting option string: &#39;-h --help&#39;. Skipping.&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_parse_args</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">add_groups</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Method that parses the arguments once a configuration has been loaded.</span>

<span class="sd">        :param list of str args: list of arguments that will be parsed.</span>
<span class="sd">        :param bool add_groups: whether to add grouped arguments to the main dictionary ``opts``.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Parse the arguments</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Parsing arguments...&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_help_command</span> <span class="ow">and</span> <span class="nb">set</span><span class="p">(</span><span class="n">args</span><span class="p">)</span><span class="o">.</span><span class="n">intersection</span><span class="p">({</span><span class="s1">&#39;-h&#39;</span><span class="p">,</span> <span class="s1">&#39;--help&#39;</span><span class="p">}):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">print_help</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">args</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_args</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">opts</span> <span class="o">=</span> <span class="nb">vars</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">)</span>
        <span class="c1"># Modify group dictionaries</span>
        <span class="k">for</span> <span class="n">group</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">groups</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">groups</span><span class="p">[</span><span class="n">group</span><span class="p">]:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">groups</span><span class="p">[</span><span class="n">group</span><span class="p">][</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">opts</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">add_groups</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">opts</span><span class="p">[</span><span class="n">group</span><span class="o">.</span><span class="n">lower</span><span class="p">()]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">groups</span><span class="p">[</span><span class="n">group</span><span class="p">]</span>

<div class="viewcode-block" id="Parser.print_conf"><a class="viewcode-back" href="../code/utils_libraries.html#lib_sconf.Parser.print_conf">[docs]</a>    <span class="k">def</span> <span class="nf">print_conf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">conf</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Prints the configuration file or string passed as argument ``conf`` or print the already loaded</span>
<span class="sd">        configuration. If ``conf=&#39;example&#39;``, print an example configuration.</span>

<span class="sd">        :param str or None conf: configuration file or string.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">conf</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">conf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_conf</span>
        <span class="k">elif</span> <span class="n">conf</span> <span class="o">!=</span> <span class="s1">&#39;example&#39;</span><span class="p">:</span>
            <span class="n">conf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_load_conf_file</span><span class="p">(</span><span class="n">conf</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">conf</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">conf</span> <span class="o">==</span> <span class="s1">&#39;example&#39;</span><span class="p">:</span>  <span class="c1"># No configuration is loaded, and ``conf`` is invalid. Print example.</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">EXAMPLE_CONF</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">conf</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="Options"><a class="viewcode-back" href="../code/utils_libraries.html#lib_sconf.Options">[docs]</a><span class="k">class</span> <span class="nc">Options</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span></div>


<div class="viewcode-block" id="parser_init"><a class="viewcode-back" href="../code/utils_libraries.html#lib_sconf.parser_init">[docs]</a><span class="k">def</span> <span class="nf">parser_init</span><span class="p">(</span><span class="n">arguments</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Function to handle arguments from CLI:</span>
<span class="sd">        First Parsing -  We parse optional configuration files.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">arguments</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">arguments</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
    <span class="n">pars</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">(</span><span class="n">add_help</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">pars</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-f&#39;</span><span class="p">,</span> <span class="s1">&#39;--file&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s2">&quot;conf.txt&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;-f&#39;</span><span class="p">,</span> <span class="n">metavar</span><span class="o">=</span><span class="s1">&#39;&lt;file&gt;&#39;</span><span class="p">)</span>
    <span class="n">pars</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-db&#39;</span><span class="p">,</span> <span class="s1">&#39;--debug&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s2">&quot;INFO&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;db&#39;</span><span class="p">,</span> <span class="n">metavar</span><span class="o">=</span><span class="s1">&#39;&lt;debug&gt;&#39;</span><span class="p">,</span>
                      <span class="n">choices</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;DEBUG&#39;</span><span class="p">,</span> <span class="s1">&#39;INFO&#39;</span><span class="p">,</span> <span class="s1">&#39;WARNING&#39;</span><span class="p">,</span> <span class="s1">&#39;ERROR&#39;</span><span class="p">,</span> <span class="s1">&#39;CRITICAL&#39;</span><span class="p">])</span>
    <span class="c1"># Check for arguments matching the latter options</span>
    <span class="n">args</span> <span class="o">=</span> <span class="n">pars</span><span class="o">.</span><span class="n">parse_known_args</span><span class="p">(</span><span class="n">arguments</span><span class="p">)</span>
    <span class="n">conf_file</span> <span class="o">=</span> <span class="nb">vars</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">])[</span><span class="s1">&#39;-f&#39;</span><span class="p">]</span>  <span class="c1"># Configuration file (if any)</span>
    <span class="n">debug_level</span> <span class="o">=</span> <span class="nb">vars</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">])[</span><span class="s1">&#39;db&#39;</span><span class="p">]</span>
    <span class="n">hlp</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">op</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
        <span class="k">if</span> <span class="n">op</span> <span class="o">==</span> <span class="s1">&#39;-h&#39;</span> <span class="ow">or</span> <span class="n">op</span> <span class="o">==</span> <span class="s1">&#39;--help&#39;</span><span class="p">:</span>
            <span class="n">hlp</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">return</span> <span class="n">conf_file</span><span class="p">,</span> <span class="n">debug_level</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">hlp</span></div>


<div class="viewcode-block" id="parser"><a class="viewcode-back" href="../code/utils_libraries.html#lib_sconf.parser">[docs]</a><span class="k">def</span> <span class="nf">parser</span><span class="p">(</span><span class="n">config_file</span><span class="p">,</span> <span class="n">arguments</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">usage</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">groups</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;Parameters&#39;</span><span class="p">,)):</span>
    <span class="sd">&quot;&quot;&quot; Function to handle arguments from CLI:</span>
<span class="sd">        Second Parsing -  We parse simulation parameters.</span>

<span class="sd">    :param str config_file: YAML format. See config_doc variable and YAML documentation for more help.</span>
<span class="sd">    :param list arguments: if there is a previous parsing, introduce the arguments here.</span>
<span class="sd">    :param str description: Description of the script/program (string)</span>
<span class="sd">    :param str usage: How to use the script. (string)</span>
<span class="sd">    :param groups: Special groups to take into account</span>
<span class="sd">    :type groups: tuple(str)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">global</span> <span class="n">log</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Starting second parsing.&#39;</span><span class="p">)</span>
    <span class="k">except</span> <span class="p">(</span><span class="ne">NameError</span><span class="p">,</span> <span class="ne">AttributeError</span><span class="p">):</span>
        <span class="n">log</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s1">&#39;sconf&#39;</span><span class="p">)</span>
    <span class="n">config_doc</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        Block example title:</span>
<span class="s2">          -a --argument:</span>
<span class="s2">            description: &quot;Example of how to introduce list arguments.&quot;</span>
<span class="s2">            default:     [1]</span>
<span class="s2">            name:        &quot;&lt;argument&gt;&quot;</span>
<span class="s2">            choices:     ~</span>
<span class="s2">          -anthr --another:</span>
<span class="s2">            description: &quot;Another example, for float arguments.&quot;</span>
<span class="s2">            default:     0.0</span>
<span class="s2">            name:        &quot;&lt;another&gt;&quot;</span>
<span class="s2">            choices:     ~</span>
<span class="s2">        Another Block example title:</span>
<span class="s2">          -s --string:</span>
<span class="s2">            description: &quot;String argument example with choices.&quot;</span>
<span class="s2">            default:     &#39;string&#39;</span>
<span class="s2">            name:        &quot;&lt;string&gt;&quot;</span>
<span class="s2">            choices:     [&#39;string1&#39;, &#39;string2&#39;]</span>
<span class="s2">          -b --boolean:</span>
<span class="s2">            description: &quot;Boolean argument example with choices.&quot;</span>
<span class="s2">            default:     False</span>
<span class="s2">            name:        &quot;&lt;bool&gt;&quot;</span>
<span class="s2">            choices:     [False, True]</span>
<span class="s2">    &quot;&quot;&quot;</span>

    <span class="c1"># Opening the configuration file to load parameters</span>
    <span class="n">options</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">gprmts</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">ops</span> <span class="o">=</span> <span class="n">Options</span><span class="p">()</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">config_file</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;#conf&quot;</span><span class="p">):</span>
            <span class="n">options</span> <span class="o">=</span> <span class="n">yaml</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">config_file</span><span class="p">,</span> <span class="n">Loader</span><span class="o">=</span><span class="n">yaml</span><span class="o">.</span><span class="n">FullLoader</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">options</span> <span class="o">=</span> <span class="n">yaml</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="n">config_file</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">),</span> <span class="n">Loader</span><span class="o">=</span><span class="n">yaml</span><span class="o">.</span><span class="n">FullLoader</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">IOError</span><span class="p">:</span>
        <span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;The configuration file &#39;</span><span class="si">%s</span><span class="s2">&#39; is missing&quot;</span> <span class="o">%</span> <span class="n">config_file</span><span class="p">)</span>
        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;No configuration loaded.&quot;</span><span class="p">)</span>
        <span class="n">options</span> <span class="o">=</span> <span class="n">yaml</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">config_doc</span><span class="p">,</span> <span class="n">Loader</span><span class="o">=</span><span class="n">yaml</span><span class="o">.</span><span class="n">FullLoader</span><span class="p">)</span>
    <span class="k">except</span> <span class="n">yaml</span><span class="o">.</span><span class="n">YAMLError</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
        <span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Error in configuration file:&quot;</span><span class="p">,</span> <span class="n">exc</span><span class="p">)</span>
        <span class="n">exit</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>

    <span class="c1"># Loading parameters from the &#39;options&#39; dictionary and CLI options</span>
    <span class="k">if</span> <span class="n">usage</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">usage</span> <span class="o">=</span> <span class="s1">&#39;python </span><span class="si">%s</span><span class="s1"> [-O &lt;options&gt;]&#39;</span> <span class="o">%</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">pars</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">(</span>
        <span class="n">description</span><span class="o">=</span><span class="n">description</span><span class="p">,</span>
        <span class="n">usage</span><span class="o">=</span><span class="n">usage</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">group</span> <span class="ow">in</span> <span class="n">options</span><span class="p">:</span>  <span class="c1"># Search and store arguments by groups</span>
        <span class="k">if</span> <span class="n">group</span> <span class="ow">in</span> <span class="n">groups</span><span class="p">:</span>
            <span class="n">gprmts</span><span class="p">[</span><span class="n">group</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;dummy&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">}</span>
        <span class="n">gr</span> <span class="o">=</span> <span class="n">pars</span><span class="o">.</span><span class="n">add_argument_group</span><span class="p">(</span><span class="n">group</span><span class="p">)</span>
        <span class="n">args</span> <span class="o">=</span> <span class="n">options</span><span class="p">[</span><span class="n">group</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">options</span><span class="p">[</span><span class="n">group</span><span class="p">]:</span>  <span class="c1"># Search keyword arguments in each group</span>
            <span class="n">flags</span> <span class="o">=</span> <span class="n">key</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">group</span> <span class="ow">in</span> <span class="n">groups</span><span class="p">:</span>
                <span class="n">gprmts</span><span class="p">[</span><span class="n">group</span><span class="p">][</span><span class="n">flags</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">:]]</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;default&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;default&#39;</span><span class="p">],</span> <span class="nb">bool</span><span class="p">):</span>  <span class="c1"># Distinguish between bool, list, and others.</span>
                <span class="n">gr</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="o">*</span><span class="n">flags</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="n">args</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;default&#39;</span><span class="p">],</span> <span class="n">help</span><span class="o">=</span><span class="n">args</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;description&#39;</span><span class="p">],</span> <span class="n">dest</span><span class="o">=</span><span class="n">flags</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">:],</span>
                                <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store_true&#39;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;default&#39;</span><span class="p">],</span> <span class="nb">list</span><span class="p">):</span>
                <span class="n">tipado</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;default&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
                <span class="n">gr</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="o">*</span><span class="n">flags</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="n">args</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;default&#39;</span><span class="p">],</span> <span class="n">help</span><span class="o">=</span><span class="n">args</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;description&#39;</span><span class="p">],</span> <span class="n">dest</span><span class="o">=</span><span class="n">flags</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">:],</span>
                                <span class="n">metavar</span><span class="o">=</span><span class="n">args</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">],</span> <span class="nb">type</span><span class="o">=</span><span class="n">tipado</span><span class="p">,</span>
                                <span class="n">choices</span><span class="o">=</span><span class="n">args</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;choices&#39;</span><span class="p">],</span> <span class="n">nargs</span><span class="o">=</span><span class="s1">&#39;+&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">gr</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="o">*</span><span class="n">flags</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="n">args</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;default&#39;</span><span class="p">],</span> <span class="n">help</span><span class="o">=</span><span class="n">args</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;description&#39;</span><span class="p">],</span> <span class="n">dest</span><span class="o">=</span><span class="n">flags</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">:],</span>
                                <span class="n">metavar</span><span class="o">=</span><span class="n">args</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">],</span> <span class="nb">type</span><span class="o">=</span><span class="nb">type</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;default&#39;</span><span class="p">]),</span>
                                <span class="n">choices</span><span class="o">=</span><span class="n">args</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;choices&#39;</span><span class="p">])</span>

    <span class="c1"># We parse command line arguments:</span>
    <span class="k">if</span> <span class="n">arguments</span><span class="p">:</span>
        <span class="n">arg</span> <span class="o">=</span> <span class="n">arguments</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">opts</span> <span class="o">=</span> <span class="nb">vars</span><span class="p">(</span><span class="n">pars</span><span class="o">.</span><span class="n">parse_args</span><span class="p">(</span><span class="n">arg</span><span class="p">))</span>
        <span class="n">args</span> <span class="o">=</span> <span class="n">pars</span><span class="o">.</span><span class="n">parse_args</span><span class="p">(</span><span class="n">arg</span><span class="p">,</span> <span class="n">namespace</span><span class="o">=</span><span class="n">ops</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">opts</span> <span class="o">=</span> <span class="nb">vars</span><span class="p">(</span><span class="n">pars</span><span class="o">.</span><span class="n">parse_args</span><span class="p">())</span>
        <span class="n">args</span> <span class="o">=</span> <span class="n">pars</span><span class="o">.</span><span class="n">parse_args</span><span class="p">(</span><span class="n">namespace</span><span class="o">=</span><span class="n">ops</span><span class="p">)</span>

    <span class="c1"># We create separate dictionaries for &quot;special groups&quot; (see function arguments)</span>
    <span class="k">for</span> <span class="n">groupkey</span> <span class="ow">in</span> <span class="n">gprmts</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="n">gprmts</span><span class="p">[</span><span class="n">groupkey</span><span class="p">]</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;dummy&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">gprmts</span><span class="p">[</span><span class="n">groupkey</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">gprmts</span><span class="p">[</span><span class="n">groupkey</span><span class="p">][</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">opts</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
        <span class="n">opts</span><span class="p">[</span><span class="n">groupkey</span><span class="o">.</span><span class="n">lower</span><span class="p">()]</span> <span class="o">=</span> <span class="n">gprmts</span><span class="p">[</span><span class="n">groupkey</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">opts</span><span class="p">,</span> <span class="n">args</span></div>


<div class="viewcode-block" id="log_conf"><a class="viewcode-back" href="../code/utils_libraries.html#lib_sconf.log_conf">[docs]</a><span class="k">def</span> <span class="nf">log_conf</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="n">config_file</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;simulation&#39;</span><span class="p">,</span> <span class="n">logdir</span><span class="o">=</span><span class="s1">&#39;./log&#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Logging configuration. Sets the logging level and the format of display using a</span>
<span class="sd">    configuration file ``conf_file`` if provided.</span>

<span class="sd">    :param str db: debugging level, must be an attribute in logging. See help(logging).</span>
<span class="sd">    :param str config_file: external logging configuration file for handlers configuration.</span>
<span class="sd">    :param str name: name of the logger.</span>
<span class="sd">    :param str logdir: Directory where the log file is stored.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">global</span> <span class="n">log</span>
    <span class="n">logging_doc</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        version: 1</span>
<span class="s2">        formatters:</span>
<span class="s2">          simple:</span>
<span class="s2">            format: &quot;[</span><span class="si">%(levelname)-8.8s</span><span class="s2">]:</span><span class="si">%(name)-20.20s</span><span class="s2">:</span><span class="si">%(funcName)-10.10s</span><span class="s2">:</span><span class="se">\n\t</span><span class="si">%(message)s</span><span class="s2">&quot;</span>
<span class="s2">        handlers:</span>
<span class="s2">          console:</span>
<span class="s2">            class: logging.StreamHandler</span>
<span class="s2">            level: DEBUG</span>
<span class="s2">            formatter: simple</span>
<span class="s2">            stream: ext://sys.stdout</span>
<span class="s2">          file:</span>
<span class="s2">            class: logging.FileHandler</span>
<span class="s2">            level: DEBUG</span>
<span class="s2">            formatter: simple</span>
<span class="s2">            filename: &#39;log/&quot;&quot;&quot;</span> <span class="o">+</span> <span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;&quot;&quot;.log&#39;</span>
<span class="s2">        loggers:</span>
<span class="s2">          simulation:</span>
<span class="s2">            level: DEBUG</span>
<span class="s2">            handlers: [console, file]</span>
<span class="s2">            propagate: no</span>
<span class="s2">        root:</span>
<span class="s2">          level: DEBUG</span>
<span class="s2">          handlers: [console, file]</span>
<span class="s2">    &quot;&quot;&quot;</span>

    <span class="c1"># Setting debug level</span>
    <span class="n">debug</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">logging</span><span class="p">,</span> <span class="n">db</span><span class="o">.</span><span class="n">upper</span><span class="p">(),</span> <span class="kc">None</span><span class="p">)</span>
    <span class="c1"># Check the value</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">debug</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Invalid log level: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">db</span><span class="p">)</span>
    <span class="c1"># Check logging folder (default is log)</span>
    <span class="n">cwd</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">logdir</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">logdir</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">IOError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s1">&#39;Path </span><span class="si">%s</span><span class="s1">/</span><span class="si">%s</span><span class="s1"> does not exist.&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">cwd</span><span class="p">,</span> <span class="n">logdir</span><span class="p">))</span>
    <span class="n">filename</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">/</span><span class="si">%s</span><span class="s2">.log&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">logdir</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
        <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;a+&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;w+&#39;</span><span class="p">)</span>
    <span class="n">day</span><span class="p">,</span> <span class="n">hour</span> <span class="o">=</span> <span class="n">now</span><span class="p">()</span>
    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">[</span><span class="si">%s</span><span class="se">\t</span><span class="si">%s</span><span class="s2">]</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">day</span><span class="p">,</span> <span class="n">hour</span><span class="p">))</span>
    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;-------------------------</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="c1"># Output format</span>
    <span class="n">logformat</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%(log_color)s</span><span class="s2">[</span><span class="si">%(levelname)-8.8s</span><span class="s2">]</span><span class="si">%(reset)s</span><span class="s2"> </span><span class="si">%(name)-12.12s</span><span class="s2">:</span><span class="si">%(funcName)-8.8s</span><span class="s2">: &quot;</span> \
                <span class="s2">&quot;</span><span class="si">%(log_color)s%(message)s%(reset)s</span><span class="s2">&quot;</span>
    <span class="n">formatter</span> <span class="o">=</span> <span class="n">ColoredFormatter</span><span class="p">(</span><span class="n">logformat</span><span class="p">,</span> <span class="n">log_colors</span><span class="o">=</span><span class="p">{</span>
        <span class="s1">&#39;DEBUG&#39;</span><span class="p">:</span> <span class="s1">&#39;cyan&#39;</span><span class="p">,</span>
        <span class="s1">&#39;INFO&#39;</span><span class="p">:</span> <span class="s1">&#39;white&#39;</span><span class="p">,</span>
        <span class="s1">&#39;WARNING&#39;</span><span class="p">:</span> <span class="s1">&#39;yellow&#39;</span><span class="p">,</span>
        <span class="s1">&#39;ERROR&#39;</span><span class="p">:</span> <span class="s1">&#39;red&#39;</span><span class="p">,</span>
        <span class="s1">&#39;CRITICAL&#39;</span><span class="p">:</span> <span class="s1">&#39;red,bg_white&#39;</span><span class="p">,</span>
    <span class="p">})</span>

    <span class="c1"># General Configuration</span>
    <span class="k">if</span> <span class="n">config_file</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">dictConfig</span><span class="p">(</span><span class="n">yaml</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="n">config_file</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">),</span> <span class="n">Loader</span><span class="o">=</span><span class="n">yaml</span><span class="o">.</span><span class="n">FullLoader</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">dictConfig</span><span class="p">(</span><span class="n">yaml</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">logging_doc</span><span class="p">,</span> <span class="n">Loader</span><span class="o">=</span><span class="n">yaml</span><span class="o">.</span><span class="n">FullLoader</span><span class="p">))</span>

    <span class="c1"># Handler</span>
    <span class="n">handler</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">handlers</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">handler</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">debug</span><span class="p">)</span>
    <span class="n">handler</span><span class="o">.</span><span class="n">setFormatter</span><span class="p">(</span><span class="n">formatter</span><span class="p">)</span>
    <span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
    <span class="n">log</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s1">&#39;lib_sconf&#39;</span><span class="p">)</span>
    <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Logger succesfully set up. Starting debuging, level: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">db</span><span class="p">)</span>

    <span class="n">mylog</span> <span class="o">=</span> <span class="n">MyLog</span><span class="p">(</span><span class="n">debug</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">logger</span><span class="p">,</span> <span class="n">mylog</span></div>


<div class="viewcode-block" id="MyLog"><a class="viewcode-back" href="../code/utils_libraries.html#lib_sconf.MyLog">[docs]</a><span class="k">class</span> <span class="nc">MyLog</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;A class that handles the deployment of :func:`MyLog.msg` taking into account the</span>
<span class="sd">    debugging level.</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="MyLog.__init__"><a class="viewcode-back" href="../code/generated/lib_sconf.MyLog.html#lib_sconf.MyLog.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">level</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        :param int level: debugging level, following :py:class:`logging` similar scale.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_level</span> <span class="o">=</span> <span class="n">level</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_levels</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">debug</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">info</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">warning</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">error</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">critical</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">passed</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s1">&#39;info&#39;</span><span class="p">,</span> <span class="n">del_pb</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Log an OK/FAILED message on the previously (line above) logged/printed message.</span>

<span class="sd">        :param int passed: code to indicate the type of message. (0: OK, -1: FAILED warn, any: FAILED error)</span>
<span class="sd">        :param str level: debugging level (&#39;debug&#39;, &#39;info&#39;, &#39;error&#39;, &#39;critical&#39;)</span>
<span class="sd">        :param bool del_pb: whether to delete the current line&#39;s content.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_level</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_levels</span><span class="p">[</span><span class="n">level</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="n">passed</span><span class="p">,</span> <span class="n">del_pb</span><span class="p">)</span>

    <span class="c1"># noinspection PyTypeChecker</span>
<div class="viewcode-block" id="MyLog.msg"><a class="viewcode-back" href="../code/utils_libraries.html#lib_sconf.MyLog.msg">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">msg</span><span class="p">(</span><span class="n">error</span><span class="p">,</span> <span class="n">del_pb</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">flush</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">up_lines</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Prints (or deletes) a colored OK/FAILED in a previously printed line.</span>

<span class="sd">        :param int error: integer value that determines the what to print.</span>
<span class="sd">        :param bool del_pb: whether to delete the current line before printing.</span>
<span class="sd">        :param bool flush: whether to flush the stdout buffer or not (default is True).</span>
<span class="sd">        :param int up_lines: number of lines to move the cursor upwards.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Save current cursor position</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">ESC</span> <span class="o">+</span> <span class="s2">&quot;[s&quot;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">flush</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>  <span class="c1"># To get the cursor is necessary to flush.</span>
        <span class="k">if</span> <span class="n">del_pb</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">DEL_LINE</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">flush</span><span class="o">=</span><span class="n">flush</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">error</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">UP</span> <span class="o">*</span> <span class="n">up_lines</span> <span class="o">+</span> <span class="n">RIGHT</span> <span class="o">+</span> <span class="n">GREEN</span> <span class="o">+</span> <span class="s2">&quot;OK&quot;</span><span class="o">.</span><span class="n">ljust</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span> <span class="o">+</span> <span class="n">WHITE</span><span class="p">,</span> <span class="n">flush</span><span class="o">=</span><span class="n">flush</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">error</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">UP</span> <span class="o">*</span> <span class="n">up_lines</span> <span class="o">+</span> <span class="n">RIGHT</span> <span class="o">+</span> <span class="n">YELLOW</span> <span class="o">+</span> <span class="s2">&quot;FAILED&quot;</span><span class="o">.</span><span class="n">ljust</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span> <span class="o">+</span> <span class="n">WHITE</span><span class="p">,</span> <span class="n">flush</span><span class="o">=</span><span class="n">flush</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">UP</span> <span class="o">*</span> <span class="n">up_lines</span> <span class="o">+</span> <span class="n">RIGHT</span> <span class="o">+</span> <span class="n">RED</span> <span class="o">+</span> <span class="s2">&quot;FAILED&quot;</span><span class="o">.</span><span class="n">ljust</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span> <span class="o">+</span> <span class="n">WHITE</span><span class="p">,</span> <span class="n">flush</span><span class="o">=</span><span class="n">flush</span><span class="p">)</span>
        <span class="c1"># Go back to the initial cursor position</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">ESC</span> <span class="o">+</span> <span class="s2">&quot;[u&quot;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">flush</span><span class="o">=</span><span class="n">flush</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="debug_func"><a class="viewcode-back" href="../code/utils_libraries.html#lib_sconf.debug_func">[docs]</a><span class="k">def</span> <span class="nf">debug_func</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Decorator: Print the function signature and return value&quot;&quot;&quot;</span>

    <span class="nd">@functools</span><span class="o">.</span><span class="n">wraps</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">wrapper_debug</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">args_repr</span> <span class="o">=</span> <span class="p">[</span><span class="nb">repr</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">args</span><span class="p">]</span>  <span class="c1"># 1</span>
        <span class="n">kwargs_repr</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">v</span><span class="si">!r}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">items</span><span class="p">()]</span>  <span class="c1"># 2</span>
        <span class="n">signature</span> <span class="o">=</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">args_repr</span> <span class="o">+</span> <span class="n">kwargs_repr</span><span class="p">)</span>  <span class="c1"># 3</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Calling </span><span class="si">{</span><span class="n">func</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">(</span><span class="si">{</span><span class="n">signature</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
        <span class="n">value</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">func</span><span class="o">.</span><span class="vm">__name__</span><span class="si">!r}</span><span class="s2"> returned </span><span class="si">{</span><span class="n">value</span><span class="si">!r}</span><span class="s2">&quot;</span><span class="p">)</span>  <span class="c1"># 4</span>
        <span class="k">return</span> <span class="n">value</span>

    <span class="k">return</span> <span class="n">wrapper_debug</span></div>


<div class="viewcode-block" id="count_calls"><a class="viewcode-back" href="../code/utils_libraries.html#lib_sconf.count_calls">[docs]</a><span class="k">def</span> <span class="nf">count_calls</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Decorator: count number of calls of func.&quot;&quot;&quot;</span>

    <span class="nd">@functools</span><span class="o">.</span><span class="n">wraps</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">wrapper_count_calls</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">wrapper_count_calls</span><span class="o">.</span><span class="n">num_calls</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Call </span><span class="si">{</span><span class="n">wrapper_count_calls</span><span class="o">.</span><span class="n">num_calls</span><span class="si">}</span><span class="s2"> of </span><span class="si">{</span><span class="n">func</span><span class="o">.</span><span class="vm">__name__</span><span class="si">!r}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="n">wrapper_count_calls</span><span class="o">.</span><span class="n">num_calls</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">return</span> <span class="n">wrapper_count_calls</span></div>


<div class="viewcode-block" id="now"><a class="viewcode-back" href="../code/utils_libraries.html#lib_sconf.now">[docs]</a><span class="k">def</span> <span class="nf">now</span><span class="p">(</span><span class="n">daysep</span><span class="o">=</span><span class="s1">&#39;, &#39;</span><span class="p">,</span> <span class="n">hoursep</span><span class="o">=</span><span class="s1">&#39;:&#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Returns datetime</span>

<span class="sd">    :param str daysep: separation used for the date.</span>
<span class="sd">    :param str hoursep: separation used for the hour.</span>
<span class="sd">    :return: day and hour tuple.</span>
<span class="sd">    :rtype: Tuple[str, str]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">_now</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">timetuple</span><span class="p">()[</span><span class="mi">0</span><span class="p">:</span><span class="mi">6</span><span class="p">]</span>
    <span class="n">sday</span> <span class="o">=</span> <span class="n">daysep</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">_now</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">]))</span>
    <span class="n">shour</span> <span class="o">=</span> <span class="n">hoursep</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">_now</span><span class="p">[</span><span class="mi">3</span><span class="p">:]))</span>
    <span class="k">return</span> <span class="n">sday</span><span class="p">,</span> <span class="n">shour</span></div>


<div class="viewcode-block" id="get_paths"><a class="viewcode-back" href="../code/utils_libraries.html#lib_sconf.get_paths">[docs]</a><span class="k">def</span> <span class="nf">get_paths</span><span class="p">(</span><span class="n">filename</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Gets the real path of the ``filename``, its directory and the current working directory.</span>

<span class="sd">    :param filename: Name of file (it can be a relative path, an absolute path or just the file name).</span>
<span class="sd">    :return: dictionary including the file path (``s_path``), directory (``s_dir``) and</span>
<span class="sd">             current working directory (``dir``).</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">scriptpath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">realpath</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
    <span class="n">scriptdir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">scriptpath</span><span class="p">)</span>
    <span class="n">cwd</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span>
    <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;s_path&#39;</span><span class="p">:</span> <span class="n">scriptpath</span><span class="p">,</span> <span class="s1">&#39;s_dir&#39;</span><span class="p">:</span> <span class="n">scriptdir</span><span class="p">,</span> <span class="s1">&#39;dir&#39;</span><span class="p">:</span> <span class="n">cwd</span><span class="p">}</span></div>


<div class="viewcode-block" id="create_dir"><a class="viewcode-back" href="../code/utils_libraries.html#lib_sconf.create_dir">[docs]</a><span class="k">def</span> <span class="nf">create_dir</span><span class="p">(</span><span class="n">folder_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create a directory at ``folder_path`` if it does not exist yet.</span>

<span class="sd">    :param folder_path: name of the desired folder. It can be a relative path or an absolute path.</span>
<span class="sd">    :return: 0 if no exceptions were raised.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">path_exists</span><span class="p">(</span><span class="n">folder_path</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">folder_path</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">OSError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s1">&#39;Directory </span><span class="si">%s</span><span class="s1"> exists or could not be created.&#39;</span> <span class="o">%</span> <span class="n">folder_path</span><span class="p">)</span>
    <span class="k">return</span> <span class="mi">0</span></div>


<div class="viewcode-block" id="path_exists"><a class="viewcode-back" href="../code/utils_libraries.html#lib_sconf.path_exists">[docs]</a><span class="k">def</span> <span class="nf">path_exists</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">path</span><span class="p">)</span></div>


<div class="viewcode-block" id="check_overwrite"><a class="viewcode-back" href="../code/utils_libraries.html#lib_sconf.check_overwrite">[docs]</a><span class="k">def</span> <span class="nf">check_overwrite</span><span class="p">(</span><span class="n">filename</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">],</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Checks whether the path of the target filename exists. If it does, asks to overwrite or change name of file.</span>

<span class="sd">    :param filename: name or path of the file to be created or overwritten.</span>
<span class="sd">    :keyword bool force: whether to force overwriting (if necessary) without asking, *defaults to False*</span>
<span class="sd">    :keyword bool auto: whether to automatically create a new file with an appended string, *defaults to True*</span>
<span class="sd">    :keyword Union[None, str, bytes] append: Optional appendix to be added to the filename in case it already exists.</span>
<span class="sd">    :keyword int lzeros: number of digits that the version will have with leading zeros, *defaults to 3*</span>
<span class="sd">    :return: path of ``filename`` or of the new file name.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">filename</span> <span class="o">=</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
    <span class="n">parent</span> <span class="o">=</span> <span class="n">filename</span><span class="o">.</span><span class="n">parent</span>
    <span class="n">suffix</span> <span class="o">=</span> <span class="n">filename</span><span class="o">.</span><span class="n">suffix</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">filename</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">removesuffix</span><span class="p">(</span><span class="n">suffix</span><span class="p">)</span>
    <span class="n">file_v</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">append</span><span class="p">,</span> <span class="n">append_fmt</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;append&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;_%0</span><span class="si">{</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;lzeros&#39;</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span><span class="si">}</span><span class="s2">d&quot;</span>
    <span class="k">while</span> <span class="n">filename</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;File &#39;</span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2">&#39; already exists.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;force&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
            <span class="k">break</span>
        <span class="k">elif</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;auto&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">append</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">filename</span> <span class="o">=</span> <span class="n">parent</span><span class="o">.</span><span class="n">joinpath</span><span class="p">(</span><span class="n">name</span> <span class="o">+</span> <span class="n">append_fmt</span> <span class="o">%</span> <span class="n">file_v</span> <span class="o">+</span> <span class="n">suffix</span><span class="p">)</span>
                <span class="n">file_v</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">filename</span> <span class="o">=</span> <span class="n">parent</span><span class="o">.</span><span class="n">joinpath</span><span class="p">(</span><span class="n">name</span> <span class="o">+</span> <span class="n">append</span> <span class="o">+</span> <span class="n">suffix</span><span class="p">)</span>
                <span class="n">append_fmt</span> <span class="o">=</span> <span class="n">append</span> <span class="o">+</span> <span class="n">append_fmt</span>
                <span class="n">append</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">yesno_question</span><span class="p">(</span><span class="s1">&#39;Do you want to overwrite </span><span class="si">%s</span><span class="s1">?&#39;</span> <span class="o">%</span> <span class="n">filename</span><span class="p">):</span>
                <span class="k">break</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">filename</span> <span class="o">=</span> <span class="n">parent</span><span class="o">.</span><span class="n">joinpath</span><span class="p">(</span><span class="nb">input</span><span class="p">(</span><span class="s1">&#39;Write a new name for the file: &#39;</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">filename</span></div>


<div class="viewcode-block" id="yesno_question"><a class="viewcode-back" href="../code/utils_libraries.html#lib_sconf.yesno_question">[docs]</a><span class="k">def</span> <span class="nf">yesno_question</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="n">default_answer</span><span class="o">=</span><span class="s1">&#39;N&#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Simple terminal oriented yes/no question generator.</span>

<span class="sd">    :param str message: question to show in prompt.</span>
<span class="sd">    :param str default_answer: default answer (When ENTER is hit).</span>
<span class="sd">    :return: whether the answer was yes or no.</span>
<span class="sd">    :rtype: bool</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">options</span><span class="p">,</span> <span class="n">response</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;(y/N)&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span> <span class="k">if</span> <span class="n">default_answer</span><span class="o">.</span><span class="n">capitalize</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;N&#39;</span><span class="p">)</span> <span class="k">else</span> <span class="p">(</span><span class="s1">&#39;(Y/n)&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
    <span class="n">yes_no</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
    <span class="k">while</span> <span class="ow">not</span> <span class="n">yes_no</span><span class="o">.</span><span class="n">capitalize</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">((</span><span class="s1">&#39;Y&#39;</span><span class="p">,</span> <span class="s1">&#39;N&#39;</span><span class="p">))</span> <span class="ow">and</span> <span class="n">yes_no</span> <span class="o">!=</span> <span class="s1">&#39;</span><span class="se">\r</span><span class="s1">&#39;</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">message</span> <span class="o">+</span> <span class="n">options</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">flush</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">yes_no</span> <span class="o">=</span> <span class="n">readchar</span><span class="o">.</span><span class="n">readchar</span><span class="p">()</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">yes_no</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">yes_no</span><span class="o">.</span><span class="n">capitalize</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;Y&#39;</span><span class="p">):</span>
        <span class="n">response</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">elif</span> <span class="n">yes_no</span><span class="o">.</span><span class="n">capitalize</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;N&#39;</span><span class="p">):</span>
        <span class="n">response</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">return</span> <span class="n">response</span></div>


<div class="viewcode-block" id="save_obj"><a class="viewcode-back" href="../code/utils_libraries.html#lib_sconf.save_obj">[docs]</a><span class="k">def</span> <span class="nf">save_obj</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">directory</span><span class="o">=</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="n">extension</span><span class="o">=</span><span class="s1">&#39;.pkl&#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Save ``obj`` at path given by ``name`` or ``directory/name``.</span>

<span class="sd">    :param object obj: object to be saved in binary format.</span>
<span class="sd">    :param str name: name of the file.</span>
<span class="sd">    :param str directory: name of the directory where the ``obj`` will be saved.</span>
<span class="sd">    :param str extension: extension used to save the object.</span>
<span class="sd">    :return: True if the process was successful, False if not.</span>
<span class="sd">    :rtype: bool</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">path</span><span class="p">,</span> <span class="n">filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">path</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
        <span class="n">path</span> <span class="o">=</span> <span class="n">directory</span>
    <span class="n">path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span> <span class="o">+</span> <span class="n">extension</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">pickle</span><span class="o">.</span><span class="n">HIGHEST_PROTOCOL</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">IOError</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Saving object at </span><span class="si">{</span><span class="n">path</span> <span class="o">+</span> <span class="n">extension</span><span class="si">}</span><span class="s1"> failed.&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">False</span>
    <span class="k">return</span> <span class="kc">True</span></div>


<div class="viewcode-block" id="load_obj"><a class="viewcode-back" href="../code/utils_libraries.html#lib_sconf.load_obj">[docs]</a><span class="k">def</span> <span class="nf">load_obj</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">directory</span><span class="o">=</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="n">extension</span><span class="o">=</span><span class="s1">&#39;.pkl&#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Load an ``object`` from ``name`` or ``directory/name``.</span>

<span class="sd">    :param str name: name of the file.</span>
<span class="sd">    :param str directory: name of the directory where the file is.</span>
<span class="sd">    :param str extension: extension of the loaded file-name.</span>
<span class="sd">    :return: loaded object or False</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">path</span><span class="p">,</span> <span class="n">filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">path</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
        <span class="n">path</span> <span class="o">=</span> <span class="n">directory</span>
    <span class="n">path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span> <span class="o">+</span> <span class="n">extension</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">IOError</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Loading object from </span><span class="si">{</span><span class="n">path</span> <span class="o">+</span> <span class="n">extension</span><span class="si">}</span><span class="s1"> failed.&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">False</span></div>


<div class="viewcode-block" id="isnotebook"><a class="viewcode-back" href="../code/utils_libraries.html#lib_sconf.isnotebook">[docs]</a><span class="k">def</span> <span class="nf">isnotebook</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Check whether the execution is being done inside a notebook (``ipython`` or ``jupyter``).&quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># noinspection PyUnresolvedReferences</span>
        <span class="n">shell</span> <span class="o">=</span> <span class="n">get_ipython</span><span class="p">()</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span>
        <span class="k">if</span> <span class="n">shell</span> <span class="o">==</span> <span class="s1">&#39;ZMQInteractiveShell&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span>  <span class="c1"># Jupyter notebook or qtconsole</span>
        <span class="k">elif</span> <span class="n">shell</span> <span class="o">==</span> <span class="s1">&#39;TerminalInteractiveShell&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>  <span class="c1"># Terminal running IPython</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>  <span class="c1"># Other type (?)</span>
    <span class="k">except</span> <span class="ne">NameError</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">False</span>  <span class="c1"># Probably standard Python interpreter</span></div>


<div class="viewcode-block" id="LimitedSizeDict"><a class="viewcode-back" href="../code/utils_libraries.html#lib_sconf.LimitedSizeDict">[docs]</a><span class="k">class</span> <span class="nc">LimitedSizeDict</span><span class="p">(</span><span class="n">OrderedDict</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Modified ordered-dictionary which has its size limited by ``size_limit``.&quot;&quot;&quot;</span>

<div class="viewcode-block" id="LimitedSizeDict.__init__"><a class="viewcode-back" href="../code/generated/lib_sconf.LimitedSizeDict.html#lib_sconf.LimitedSizeDict.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;See :py:class:`dict` for the general documentation on dictionaries and</span>
<span class="sd">        :py:class:`collections.OrderedDict` for documentation about ordered dictionaries.</span>
<span class="sd">        This custom implementation sets a limit to the size of the dictionary by popping the oldest</span>
<span class="sd">        stored item when the ``size_limit`` has been reached.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">size_limit</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;size_limit&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">OrderedDict</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_check_size_limit</span><span class="p">()</span></div>

    <span class="k">def</span> <span class="fm">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">OrderedDict</span><span class="o">.</span><span class="fm">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_check_size_limit</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_check_size_limit</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Check if size limit has been reached, and pop the oldest element of the dictionary in that case.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">size_limit</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">size_limit</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">popitem</span><span class="p">(</span><span class="n">last</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></div>


<div class="viewcode-block" id="print_at"><a class="viewcode-back" href="../code/utils_libraries.html#lib_sconf.print_at">[docs]</a><span class="k">def</span> <span class="nf">print_at</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">x_cursor</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">y_cursor</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">flush</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">cursor</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Print ``text`` at the specified coordinates through stdout. Origin (0, 0) is the current</span>
<span class="sd">    cursor position. It uses ANSI escape (ESC) commands to move through the terminal&#39;s screen.</span>
<span class="sd">    See for example &lt;https://es.wikipedia.org/wiki/C%C3%B3digo_escape_ANSI&gt;`_ for additional details</span>
<span class="sd">    about these commands.</span>

<span class="sd">    :param str text: text to be printed.</span>
<span class="sd">    :param int x_cursor: horizontal coordinate.</span>
<span class="sd">    :param int y_cursor: vertical coordinate.</span>
<span class="sd">    :param bool flush: whether to flush the stdout buffer or not (default: True).</span>
<span class="sd">    :param bool cursor: whether to use the cursor position to go back after printing.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">cursor</span><span class="p">:</span>  <span class="c1"># Save cursor position:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">ESC</span> <span class="o">+</span> <span class="s2">&quot;[s&quot;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">flush</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>  <span class="c1"># To get the cursor is necessary to flush.</span>
    <span class="c1"># Move to the desired position and print the text</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">ESC</span> <span class="o">+</span> <span class="s2">&quot;[</span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">abs</span><span class="p">(</span><span class="n">x_cursor</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="s1">&#39;C&#39;</span> <span class="k">if</span> <span class="n">x_cursor</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="k">else</span> <span class="s1">&#39;D&#39;</span><span class="p">)</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">ESC</span> <span class="o">+</span> <span class="s2">&quot;[</span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">abs</span><span class="p">(</span><span class="n">y_cursor</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="s1">&#39;A&#39;</span> <span class="k">if</span> <span class="n">y_cursor</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="k">else</span> <span class="s1">&#39;B&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="n">y</span> <span class="o">+</span> <span class="n">text</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">flush</span><span class="o">=</span><span class="n">flush</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">cursor</span><span class="p">:</span>  <span class="c1"># Go back to the initial cursor position</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">ESC</span> <span class="o">+</span> <span class="s2">&quot;[u&quot;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">flush</span><span class="o">=</span><span class="n">flush</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">y_cursor</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">*</span> <span class="n">y_cursor</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">flush</span><span class="o">=</span><span class="n">flush</span><span class="p">)</span></div>


<div class="viewcode-block" id="move_cursor_at"><a class="viewcode-back" href="../code/utils_libraries.html#lib_sconf.move_cursor_at">[docs]</a><span class="k">def</span> <span class="nf">move_cursor_at</span><span class="p">(</span><span class="n">x_cursor</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">y_cursor</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">flush</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Move the cursor to the specify coordinates. Origin (0, 0) is the current</span>
<span class="sd">    cursor position. It uses ANSI escape (ESC) commands to move through the terminal&#39;s screen.</span>
<span class="sd">    See for example &lt;https://es.wikipedia.org/wiki/C%C3%B3digo_escape_ANSI&gt;`_ for additional details</span>
<span class="sd">    about these commands.</span>

<span class="sd">    :param int x_cursor: horizontal coordinate.</span>
<span class="sd">    :param int y_cursor: vertical coordinate.</span>
<span class="sd">    :param bool flush: whether to flush the stdout buffer or not (default: True).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Move to the desired position</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">ESC</span> <span class="o">+</span> <span class="s2">&quot;[</span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">abs</span><span class="p">(</span><span class="n">x_cursor</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="s1">&#39;C&#39;</span> <span class="k">if</span> <span class="n">x_cursor</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="k">else</span> <span class="s1">&#39;D&#39;</span><span class="p">)</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">ESC</span> <span class="o">+</span> <span class="s2">&quot;[</span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">abs</span><span class="p">(</span><span class="n">y_cursor</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="s1">&#39;A&#39;</span> <span class="k">if</span> <span class="n">y_cursor</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="k">else</span> <span class="s1">&#39;B&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="n">y</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">flush</span><span class="o">=</span><span class="n">flush</span><span class="p">)</span></div>


<div class="viewcode-block" id="dict_depth"><a class="viewcode-back" href="../code/utils_libraries.html#lib_sconf.dict_depth">[docs]</a><span class="k">def</span> <span class="nf">dict_depth</span><span class="p">(</span><span class="n">d</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Computes the depth of a dictionary recursively.</span>
<span class="sd">    :param dict d: dictionary.</span>
<span class="sd">    :return: depth.</span>
<span class="sd">    :rtype: int</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="k">return</span> <span class="mi">1</span> <span class="o">+</span> <span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">dict_depth</span><span class="p">,</span> <span class="n">d</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span> <span class="k">if</span> <span class="n">d</span> <span class="k">else</span> <span class="mi">0</span><span class="p">)</span>
    <span class="k">return</span> <span class="mi">0</span></div>


<div class="viewcode-block" id="fmt_latex_table"><a class="viewcode-back" href="../code/utils_libraries.html#lib_sconf.fmt_latex_table">[docs]</a><span class="k">def</span> <span class="nf">fmt_latex_table</span><span class="p">(</span><span class="n">tables</span><span class="p">,</span> <span class="n">caption</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;Caption of the table&#39;</span><span class="p">,),</span> <span class="n">label</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;tab:table1&#39;</span><span class="p">,</span> <span class="p">),</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Format the `tables` of parameters as latex tables.</span>

<span class="sd">    :param list of dict tables: tables of parameters as dictionaries. See :func:`lib_ring.generate_table`.</span>
<span class="sd">    :param list or tuple of str caption: captions of the tables.</span>
<span class="sd">    :param list or tuple of str label: labels of the tables.</span>
<span class="sd">    :param kwargs: other options to control the aspect of the tables.</span>
<span class="sd">    :return: list of tables, each composed of a list of strings that can be printed or saved to generate the latex</span>
<span class="sd">             code.</span>
<span class="sd">    :rytpe: [list of str]</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">shortcaption</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;shortcaption&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">tables</span><span class="p">))</span>
    <span class="n">vem</span><span class="p">,</span> <span class="n">wem</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;cwidths&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mi">9</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
    <span class="n">header_def</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;header&#39;</span><span class="p">,</span> <span class="p">[</span><span class="sa">r</span><span class="s2">&quot;\it Symbol&quot;</span><span class="p">,</span> <span class="s2">&quot;Value&quot;</span><span class="p">])</span>
    <span class="n">side_by_side</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;side_by_side&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
    <span class="c1"># Variables that affect the side-by-side layout</span>
    <span class="n">table_sep</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;table_sep&#39;</span><span class="p">,</span> <span class="mf">0.04</span><span class="p">)</span>
    <span class="n">table_width</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;table_width&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">table_sep</span><span class="p">)</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">tables</span><span class="p">))</span>
    <span class="n">scaletable</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;\textwidth&quot;</span> <span class="k">if</span> <span class="n">side_by_side</span> <span class="k">else</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;scale&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s2">&quot;0.7\columnwidth&quot;</span><span class="p">)</span>

    <span class="n">max_decimals</span> <span class="o">=</span> <span class="mi">3</span>
    <span class="c1"># ncols = len(header)</span>

    <span class="c1"># Write the header</span>
    <span class="n">preamble</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;\begin</span><span class="si">{table}</span><span class="s2">[htb]&quot;</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
    <span class="n">prending</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;    \bottomrule[0.8mm]&quot;</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> \
               <span class="sa">r</span><span class="s2">&quot;  \end</span><span class="si">{tabular}</span><span class="s2">}&quot;</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">tables</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">side_by_side</span><span class="p">:</span>  <span class="c1"># Single table or each table in different floating objects</span>
        <span class="n">preamble</span> <span class="o">=</span> <span class="n">preamble</span> <span class="o">+</span> \
                   <span class="sa">r</span><span class="s2">&quot;  \centering&quot;</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="n">tab_prea</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;  \caption</span><span class="si">%s</span><span class="s2">[</span><span class="si">%s</span><span class="s2">]</span><span class="si">%s</span><span class="s2">{\label{</span><span class="si">%s</span><span class="s2">} </span><span class="si">%s</span><span class="s2">}&quot;</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> \
                   <span class="sa">r</span><span class="s2">&quot;  \vspace</span><span class="si">{2mm}</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> \
                   <span class="sa">r</span><span class="s2">&quot;  \resizebox{</span><span class="si">%s</span><span class="s2">}{!}{&quot;</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> \
                   <span class="sa">r</span><span class="s2">&quot;  \begin</span><span class="si">{tabular}</span><span class="s2">[t]{@</span><span class="si">{}</span><span class="s2">v{</span><span class="si">%d</span><span class="s2">em}w{</span><span class="si">%d</span><span class="s2">em}r@</span><span class="si">{}</span><span class="s2">}&quot;</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> \
                   <span class="sa">r</span><span class="s2">&quot;    \toprule[0.8mm]&quot;</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="n">prending</span> <span class="o">=</span> <span class="n">prending</span> <span class="o">+</span> <span class="sa">r</span><span class="s2">&quot;  \vspace{-2mm}&quot;</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
    <span class="k">else</span><span class="p">:</span>  <span class="c1"># Multiple tables side by side</span>
        <span class="n">tab_prea</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot; \begin</span><span class="si">{minipage}</span><span class="s2">[b]{</span><span class="si">%s</span><span class="s2">\textwidth}&quot;</span> <span class="o">%</span> <span class="n">table_width</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> \
                   <span class="sa">r</span><span class="s2">&quot; \centering&quot;</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> \
                   <span class="sa">r</span><span class="s2">&quot;  \caption</span><span class="si">%s</span><span class="s2">[</span><span class="si">%s</span><span class="s2">]</span><span class="si">%s</span><span class="s2">{\label{</span><span class="si">%s</span><span class="s2">} </span><span class="si">%s</span><span class="s2">}&quot;</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> \
                   <span class="sa">r</span><span class="s2">&quot;  \resizebox{</span><span class="si">%s</span><span class="s2">}{!}{&quot;</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> \
                   <span class="sa">r</span><span class="s2">&quot;  \begin</span><span class="si">{tabular}</span><span class="s2">[t]{@</span><span class="si">{}</span><span class="s2">v{</span><span class="si">%d</span><span class="s2">em}w{</span><span class="si">%d</span><span class="s2">em}r@</span><span class="si">{}</span><span class="s2">}&quot;</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> \
                   <span class="sa">r</span><span class="s2">&quot;    \toprule[0.8mm]&quot;</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="n">prending</span> <span class="o">=</span> <span class="n">prending</span> <span class="o">+</span> <span class="sa">r</span><span class="s2">&quot; \end</span><span class="si">{minipage}</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>

    <span class="n">ending</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;\end</span><span class="si">{table}</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>

    <span class="n">header</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;     \multicolumn</span><span class="si">{1}</span><span class="s2">{@</span><span class="si">{}</span><span class="s2">v{</span><span class="si">%d</span><span class="s2">em}}{</span><span class="si">%s</span><span class="s2">}&quot;</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> \
             <span class="sa">r</span><span class="s2">&quot;     &amp; {</span><span class="si">%s</span><span class="s2">}&quot;</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> \
             <span class="sa">r</span><span class="s2">&quot;     &amp; </span><span class="si">%s</span><span class="s2"> </span><span class="se">\\</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> \
             <span class="sa">r</span><span class="s2">&quot;    \cmidrule(r){1-2} \cmidrule(l){3-3}&quot;</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
    <span class="n">header</span> <span class="o">=</span> <span class="n">header</span> <span class="o">%</span> <span class="p">(</span><span class="n">vem</span><span class="p">,</span> <span class="sa">r</span><span class="s2">&quot;\sffamily \textbf{</span><span class="si">%s</span><span class="s2">}&quot;</span><span class="p">,</span> <span class="n">header_def</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">header_def</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">row</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;     \multicolumn</span><span class="si">{1}</span><span class="s2">{v{</span><span class="si">%d</span><span class="s2">em}}{</span><span class="si">%s</span><span class="s2">}&quot;</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> \
          <span class="sa">r</span><span class="s2">&quot;     &amp; </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> \
          <span class="sa">r</span><span class="s2">&quot;     &amp; </span><span class="si">%s</span><span class="s2"> </span><span class="se">\\</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>

    <span class="n">midrule</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;    \cmidrule(lr){1-1}&quot;</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
    <span class="n">blockrule</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;    \midrule[0.4mm]&quot;</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>

    <span class="c1"># Separation between tables for the side-by-side layout</span>
    <span class="n">separator</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot; \begin</span><span class="si">{minipage}</span><span class="s2">[b]{</span><span class="si">%s</span><span class="s2">\textwidth}&quot;</span> <span class="o">%</span> <span class="n">table_sep</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> \
                <span class="sa">r</span><span class="s2">&quot;  \color</span><span class="si">{white}</span><span class="s2"> .&quot;</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> \
                <span class="sa">r</span><span class="s2">&quot; \end</span><span class="si">{minipage}</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>

    <span class="c1"># Build the table</span>
    <span class="n">latex_tables</span> <span class="o">=</span> <span class="p">[</span><span class="n">preamble</span><span class="p">]</span> <span class="k">if</span> <span class="n">side_by_side</span> <span class="k">else</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">t</span><span class="p">,</span> <span class="n">table</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">tables</span><span class="p">):</span>
        <span class="n">latex_table</span> <span class="o">=</span> <span class="p">[]</span> <span class="k">if</span> <span class="n">side_by_side</span> <span class="k">else</span> <span class="p">[</span><span class="n">preamble</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">t</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">side_by_side</span><span class="p">:</span>
            <span class="n">latex_table</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tab_prea</span> <span class="o">%</span> <span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">shortcaption</span><span class="p">[</span><span class="n">t</span><span class="p">],</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">label</span><span class="p">[</span><span class="n">t</span><span class="p">],</span> <span class="n">caption</span><span class="p">[</span><span class="n">t</span><span class="p">],</span> <span class="n">scaletable</span><span class="p">,</span> <span class="n">vem</span><span class="p">,</span> <span class="n">wem</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">latex_table</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">separator</span><span class="p">)</span>
            <span class="n">latex_table</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tab_prea</span> <span class="o">%</span> <span class="p">(</span><span class="s1">&#39;of&#39;</span><span class="p">,</span> <span class="n">shortcaption</span><span class="p">[</span><span class="n">t</span><span class="p">],</span> <span class="sa">r</span><span class="s2">&quot;</span><span class="si">{table}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">label</span><span class="p">[</span><span class="n">t</span><span class="p">],</span> <span class="n">caption</span><span class="p">[</span><span class="n">t</span><span class="p">],</span> <span class="n">scaletable</span><span class="p">,</span>
                                           <span class="n">vem</span><span class="p">,</span> <span class="n">wem</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
            <span class="k">if</span> <span class="n">k</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">latex_table</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">blockrule</span><span class="p">)</span>
            <span class="n">latex_table</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">header</span> <span class="o">%</span> <span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="p">(</span><span class="n">key2</span><span class="p">,</span> <span class="n">v2</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
                <span class="n">units</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span> <span class="k">if</span> <span class="n">v2</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;a.u.&#39;</span> <span class="k">else</span> <span class="s1">&#39; </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">v2</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                <span class="c1"># Format the value according to its type</span>
                <span class="n">value</span> <span class="o">=</span> <span class="n">v2</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
                    <span class="n">value</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;$</span><span class="si">{</span><span class="n">value</span><span class="si">:</span><span class="s2">d</span><span class="si">}</span><span class="s2">$&quot;</span>
                <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>  <span class="c1"># This is interpreted as a closed range</span>
                    <span class="n">vals</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">value</span><span class="p">:</span>
                        <span class="n">vals</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">format_float</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">max_decimals</span><span class="p">))</span>
                    <span class="n">value</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;$\in \left[&quot;</span> <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">vals</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">vals</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="sa">r</span><span class="s2">&quot;\right]$&quot;</span>
                <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                    <span class="n">value</span> <span class="o">=</span> <span class="s2">&quot;$&quot;</span> <span class="o">+</span> <span class="s1">&#39;$, $&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">format_float</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">max_decimals</span><span class="p">)</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">value</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&quot;$&quot;</span>
                <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">float</span><span class="p">):</span>
                    <span class="n">value</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;$</span><span class="si">{</span><span class="n">format_float</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">max_decimals</span><span class="p">)</span><span class="si">}</span><span class="s2">$&quot;</span>

                <span class="n">latex_table</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row</span> <span class="o">%</span> <span class="p">(</span><span class="n">vem</span><span class="p">,</span> <span class="n">v2</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">v2</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">value</span><span class="p">)</span> <span class="o">+</span> <span class="n">units</span><span class="p">))</span>
                <span class="k">if</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">latex_table</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">midrule</span><span class="p">)</span>
        <span class="n">latex_table</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">prending</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">side_by_side</span><span class="p">:</span>
            <span class="n">latex_table</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ending</span><span class="p">)</span>
            <span class="n">latex_tables</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">latex_table</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">latex_tables</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">latex_table</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">side_by_side</span><span class="p">:</span>
        <span class="n">latex_tables</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ending</span><span class="p">)</span>
        <span class="n">latex_tables</span> <span class="o">=</span> <span class="p">[</span><span class="n">latex_tables</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;save&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">t</span><span class="p">,</span> <span class="n">latex_table</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">latex_tables</span><span class="p">):</span>
            <span class="n">filename</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;filename&#39;</span><span class="p">,</span> <span class="s1">&#39;parameters_table&#39;</span><span class="p">)</span>
            <span class="n">filename</span> <span class="o">=</span> <span class="n">filename</span> <span class="o">+</span> <span class="s1">&#39;.tex&#39;</span> <span class="k">if</span> <span class="n">side_by_side</span> <span class="k">else</span> <span class="n">filename</span> <span class="o">+</span> <span class="p">(</span><span class="s1">&#39;_</span><span class="si">%02d</span><span class="s1">-tab&#39;</span> <span class="o">%</span> <span class="n">t</span><span class="p">)</span>
            <span class="n">filename</span> <span class="o">=</span> <span class="n">check_overwrite</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">auto</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">force</span><span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;overwrite&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">))</span><span class="o">.</span><span class="n">with_suffix</span><span class="p">(</span><span class="s1">&#39;.tex&#39;</span><span class="p">)</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fp</span><span class="p">:</span>
                <span class="n">fp</span><span class="o">.</span><span class="n">writelines</span><span class="p">(</span><span class="n">latex_table</span><span class="p">)</span>
                <span class="n">fp</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">latex_tables</span></div>


<div class="viewcode-block" id="truncate"><a class="viewcode-back" href="../code/utils_libraries.html#lib_sconf.truncate">[docs]</a><span class="k">def</span> <span class="nf">truncate</span><span class="p">(</span><span class="n">number</span><span class="p">,</span> <span class="n">digits</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Truncate the decimal number up to the `digits` decimal.</span>

<span class="sd">    :param float number: decimal number to be truncated.</span>
<span class="sd">    :param int digits: number of decimals to conserve.</span>
<span class="sd">    :return: truncated decimal number</span>
<span class="sd">    :rtype: float</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">math</span>
    <span class="n">stepper</span> <span class="o">=</span> <span class="mf">10.0</span> <span class="o">**</span> <span class="n">digits</span>
    <span class="k">return</span> <span class="n">math</span><span class="o">.</span><span class="n">trunc</span><span class="p">(</span><span class="n">stepper</span> <span class="o">*</span> <span class="n">number</span><span class="p">)</span> <span class="o">/</span> <span class="n">stepper</span></div>


<div class="viewcode-block" id="format_float"><a class="viewcode-back" href="../code/utils_libraries.html#lib_sconf.format_float">[docs]</a><span class="k">def</span> <span class="nf">format_float</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">max_decimals</span><span class="p">):</span>
    <span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
    <span class="n">value</span> <span class="o">=</span> <span class="n">x</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">value</span>
    <span class="n">close</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">decimals</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
    <span class="k">while</span> <span class="ow">not</span> <span class="n">close</span> <span class="ow">and</span> <span class="n">decimals</span> <span class="o">&lt;=</span> <span class="n">max_decimals</span><span class="p">:</span>
        <span class="n">decimals</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">value</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">decimals</span><span class="o">=</span><span class="n">decimals</span><span class="p">)</span>
        <span class="n">close</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">close</span><span class="p">:</span>  <span class="c1"># Set the format if decimals &lt;= `max_decimals`</span>
        <span class="k">if</span> <span class="n">decimals</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>  <span class="c1"># Integer</span>
            <span class="n">value</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">value</span><span class="p">)</span><span class="si">:</span><span class="s2">d</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">elif</span> <span class="n">value</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">or</span> <span class="n">decimals</span> <span class="o">&lt;</span> <span class="mi">3</span> <span class="ow">or</span> <span class="n">truncate</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>  <span class="c1"># Normal float</span>
            <span class="n">value</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">value</span><span class="si">:</span><span class="s2">.</span><span class="si">{</span><span class="n">decimals</span><span class="si">}</span><span class="s2">f</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">value</span> <span class="o">*</span> <span class="mi">10</span><span class="o">**</span><span class="n">decimals</span><span class="p">)</span><span class="si">:</span><span class="s2">d</span><span class="si">}</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="sa">r</span><span class="s2">&quot;\cdot 10^{&quot;</span> <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="o">-</span><span class="n">decimals</span><span class="si">}</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="sa">r</span><span class="s2">&quot;}&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">close</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">m</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">value</span> <span class="o">=</span> <span class="n">x</span>
        <span class="k">while</span> <span class="ow">not</span> <span class="n">close</span> <span class="ow">and</span> <span class="n">m</span> <span class="o">&lt;</span> <span class="mi">100</span><span class="p">:</span>
            <span class="n">m</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">value</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">m</span><span class="o">/</span><span class="n">x</span><span class="p">))</span>
            <span class="n">close</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="n">m</span><span class="o">/</span><span class="n">x</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">value</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">m</span> <span class="o">=</span> <span class="o">-</span><span class="n">m</span>
            <span class="n">value</span> <span class="o">=</span> <span class="o">-</span><span class="n">value</span>
        <span class="n">value</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">m</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">if</span> <span class="n">close</span> <span class="k">else</span> <span class="sa">r</span><span class="s2">&quot;\sim </span><span class="si">%.*f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">max_decimals</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">value</span></div>
</pre></div>

              </div>
              
            </main>
            <footer class="footer-article noprint">
                
    <!-- Previous / next buttons -->
<div class='prev-next-area'>
</div>
            </footer>
        </div>
    </div>
    <div class="footer-content row">
        <footer class="col footer"><p>
  
    By Jose M. Esnaola-Acebes, Alex Roxin, Klaus Wimmer<br/>
  
      &copy; Copyright 2022, Jose M. Esnaola-Acebes, Alex Roxin, Klaus Wimmer.<br/>
</p>
        </footer>
    </div>
    
</div>


      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>


  </body>
</html>